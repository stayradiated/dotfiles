#!/usr/bin/env zsh

set -euo pipefail

database=$1

case "${database}" in
  staging)
    echo 'Connecting to staging database…'
    tmux select-pane -P bg=DarkBlue
    app_name=$(heroku-find-app "runn-staging-us-app-.*")
    echo "Connecting to database for ${app_name}…"
    database_url=$(heroku config:get --app "${app_name}" DATABASE_URL)
    pgcli "${database_url}" --prompt "${app_name} » " --less-chatty
    tmux select-pane -P bg=
    ;;
  production)
    tmux select-pane -P bg=DarkRed
    app_name=$(heroku-find-app "runn-prod-eu-app-(?!fork).*")
    echo "Connecting to database for ${app_name}…"
    database_url=$(heroku config:get --app "${app_name}" DATABASE_URL)
    pgcli "${database_url}" --prompt "${app_name} » " --less-chatty
    tmux select-pane -P bg=
    ;;
  review-app)
    pr_id=$2
    app_name="runn-pr-${pr_id}-app"
    echo "Connecting to database for ${app_name}…"
    database_url=$(heroku config:get --app "${app_name}" DATABASE_URL)
    pgcli "${database_url}" --prompt "${app_name} » " --less-chatty
    ;;
  *)
    echo 'usage:
heroku-pgcli [database]

Use `pgcli` to connect to a Runn database hosted on Heroku.

Supported database names:
  staging
  production
  review-app [id]
'
    exit 1
    ;;
esac
